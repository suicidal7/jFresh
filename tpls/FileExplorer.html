<style>
.FileExplorer {
	display: flex;
	flex-flow: column nowrap;
	justify-content: flex-start;
	align-items: stretch;
	align-content: stretch;
	font-size: 1em;
}

.FileExplorer>header {
	order: 0;
	flex: 0 0 auto;
}

.FileExplorer>article>ul {
	flex: 0 0 auto;
}

.FileExplorer>article>section {
	flex: 4 1 auto;
}

.FileExplorer>article {
	flex: 3 1 auto;
	order: 1;
	display: flex;
}

.FileExplorer_LocationBar {
		display: block;
		box-sizing: border-box;
		padding: 5px;
}

.FileExplorer_LocationBar>.NavCrumbs-wrapper {
	display: flex;
		flex-direction: row;
		flex-wrap: nowrap;
		justify-content: center;
		align-items: center;
		align-content: stretch;
}

.FileExplorer_LocationBar>.NavCrumbs-wrapper>.IconButton {
			flex: 0 1 auto;
			margin: 0px 10px 0 0 !important;
			align-self: auto;
			order: 0;
}
.FileExplorer_LocationBar>.NavCrumbs-wrapper>.NavCrumbs {
			flex: 1 1 80%;
			order: 1;
			align-self: auto;
			overflow: hidden;
}
.FileExplorer_LocationBar>label {
	flex: 1 1 100%;
	align-self: flex-end;
	order: 3;
	margin-top: 5px;
	display: flex;
	overflow: hidden;
	transition: height 0.5s ease-out;
	height: 1.4em;
}
.FileExplorer_LocationBar>label.hide {
	height: 0;
}
.FileExplorer_LocationBar>label>span {
			flex: 0 0 auto;
			align-self: flex-start;
			order: 1;
			padding-right: 10px;
}
.FileExplorer_LocationBar>label>input {
			flex: 3 1 auto;
			align-self: flex-start;
			order: 2;
}

.FileExplorer_Places {
		display: block;
		min-width: 125px;
		overflow-x: none;
		overflow-y: auto;
		border: 1px solid #C8C8C8;
		float: left;
}

.FileExplorer_Places>li {
			line-height: 16px;
			padding: 0px 5px 2px 10px;
			white-space: nowrap;
}

.FileExplorer_Places>.title {
			font-weight: bold;
			margin: 5px 10px;
			padding: 0px;
			font-size: 1.2em;
}

.FileExplorer_Places>.link {
			cursor: pointer;
}

.FileExplorer_Places>.link>ins {
	width: 16px;
	height: 16px;
	display: inline-block;
	vertical-align: middle;
	margin-right: 5px;
	background: transparent url(imgs/fatcow/16x16/folder.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Home {
	background: transparent url(imgs/fatcow/16x16/house.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Desktop {
	background: transparent url(imgs/fatcow/16x16/desktop.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Documents {
	background: transparent url(imgs/fatcow/16x16/document_copies.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Downloads {
	background: transparent url(imgs/fatcow/16x16/download.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Music {
	background: transparent url(imgs/fatcow/16x16/music.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Pictures {
	background: transparent url(imgs/fatcow/16x16/camera_small.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Videos {
	background: transparent url(imgs/fatcow/16x16/film.png) top left no-repeat;
}
.FileExplorer_Places>.link>ins.places-Computer {
	background: transparent url(imgs/fatcow/16x16/computer.png) top left no-repeat;
}


</style>

<template id="jFresh.FileExplorer.LocationBar">
	<div fn="FileExplorer_LocationBar">
		<div class="NavCrumbs-wrapper">
			<div fn="IconButton" class="i24 pen"></div>
			<div fn="NavCrumbs" ></div>
		</div>
		<label><span>Location:</span><input type="text"></label>
	</div>
</template>

<template id="jFresh.FileExplorer">
	<div fn="FileExplorer">
		<header fn="Template" Template-id="jFresh.FileExplorer.LocationBar"></header>
		<article>
				<ul fn="FileExplorer_Places">
					<template id="jFresh.FileExplorer.Places.titleItem">
						<li class="title">Places</li>
					</template>
					<template id="jFresh.FileExplorer.Places.item">
						<li class="link"><ins></ins><span></span></li>
					</template>
				</ul>
			<section>Files</section>
		</article>
	</div>
</template>

<script type="text/javascript">
jFresh.fn.FileExplorer_Places = function(el, opts) {
	this.el = el;
	this.opts = opts;
	var me = this;
	
	var userHome = '/home/'+localStorage.user;
	
	this.addTitle('Places');
	this.addLink('Home', userHome);
	var p, places = [ 'Desktop', 'Documents', 'Downloads', 'Music', 'Pictures', 'Videos'  ];
	for(var i=0; i<places.length; i++) {
		p = places[i];
		this.addLink(p, userHome+'/'+p);
	}
	this.addLink('Temp', '/tmp');
	
	this.addTitle('Devices');
	this.addLink('Computer', '/');
	
	this.addTitle('Bookmarks');

	var req = new XMLHttpRequest();
	req.onreadystatechange = function() {
		if ( req.readyState!=4 || req.status!=200 ) return;
			var places = req.responseText.split("\n");
			for(var p=0; p<places.length; p++) {
				if ( !places[p].startsWith('file://') ) continue;
				
				var filename = places[p].substr(7);
				var basename;
				var idx = filename.search(/[^\\]\s/);
				if ( idx > 0 ) {
					basename = filename.substr( idx+2 );
					filename = filename.substr( 0, idx+1 );
				}
				else {
					basename = fsTools.baseName( filename );
				}
				if ( me.el.querySelector('[data-uid="'+filename+'"]') ) continue; //already added
				me.addLink(basename, filename);
			}
		
	};
	req.open('GET', '/file'+userHome+'/.gtk-bookmarks', true);
	req.send();
	
};

jFresh.fn.FileExplorer_Places.defaults = {
	titleTpl: 'jFresh.FileExplorer.Places.titleItem',
	itemTpl: 'jFresh.FileExplorer.Places.item',
	titleEl: '.title',
	linkEl: '.link>span',
	iconEl: '.link>ins',
	classPrefix: 'places-',
};

jFresh.fn.FileExplorer_Places.prototype.addTitle = function(title) {
	var el = jFresh.fn.Template.energize(this.opts.titleTpl, this.el);
console.log('closest on', this.opts.titleEl, el, el.closest(this.opts.titleEl) );
	el.closest(this.opts.titleEl).innerHTML = title;
};

jFresh.fn.FileExplorer_Places.prototype.addLink = function(title, uid) {
	var el = jFresh.fn.Template.energize(this.opts.itemTpl, this.el);
	el.closest(this.opts.iconEl).classList.add(this.opts.classPrefix+title);
	el.closest(this.opts.linkEl).innerHTML = title;
	el.setAttribute('data-uid', uid);
};



jFresh.fn.FileExplorer_LocationBar = function(el, opts) {
	var me = this;
	me.el = el;
	me.opts = opts;
	
	
	me.el.querySelector('.pen').addEventListener('click', function() {
		me.el.getElementsByTagName('label')[0].toggleClass('hide');
	});
	
	
};


jFresh.fn.FileExplorer = function(el, opts) {
};


</script>